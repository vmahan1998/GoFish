# Digestion

## Overview

Digestion converts consumed prey mass into usable energy and transfers associated contaminants such as inorganic mercury and methylmercury from stomach contents into internal body burden pools. This submodel simulates the breakdown of ingested prey at a rate proportional to the agent’s current metabolic rate. As stomach contents are digested, a fraction is converted into energy while mercury and methylmercury are incorporated into the agent’s contaminant loads. When stomach contents reach zero, agents transition into foraging mode and begin drawing on lipid reserves.

## Purpose

To simulate how migratory fish process ingested prey into energy and contaminants while linking digestive performance to metabolic rate, foraging behavior, and exposure risk. Digestion provides the energetic foundation required for movement, migration, and physiological processes while directly influencing contaminant accumulation.

## Entities, State Variables, and Scales

### Spatial and Temporal Scales

**Spatial Unit:** Patch (3 m x 3 m resolution)\
**Temporal Unit:** 5 minute time steps (tick)

### Global Variables

| Global Variable | Definition |
|-----------------|------------|
| **none required** | Digestion uses internal agent state + metabolism-rate from metabolism submodel. |

### Patch Variables

| Variable Name | Definition |
|----------------------------------------|--------------------------------|
| None required | Digestion is an internal physiological process and does not depend on patch attributes. |

### Agent Variables

| Variable Name | Definition |
|----------------------------------------|--------------------------------|
| **stomach-contents** | Total mass of prey currently held in the stomach. |
| **stomach-contents-Hg** | Inorganic mercury contained within the stomach contents. |
| **stomach-contents-MeHg** | Methylmercury contained within the stomach contents. |
| **digestion-rate** | Rate of digestion equal to the current metabolic rate. |
| **digestion-efficiency** | Fraction of digested mass converted into usable energy. |
| **energy** | Total energetic reserves available to the agent. |
| **gained-energy** | Energy gained during the current tick from digestion. |
| **mehg-foraging** | Methylmercury released from stomach contents and absorbed during digestion. |
| **hg-foraging** | Inorganic mercury released from stomach contents during digestion. |
| **mehg-foraging-total** | Cumulative methylmercury risk through feeding. |
| **hg-foraging-total** | Cumulative inorganic mercury risk via digestion. |
| **mehg-total** | Total body burden of methylmercury risk. |
| **hg-total** | Total body burden of inorganic mercury risk. |
| **foraging** | Boolean indicating whether the agent is actively searching for prey. |
| **lipid-loss** | Boolean indicating when lipid reserves are used due to lack of stomach content. |

## Process Overview and Scheduling

1.  Set digestion rate equal to the current metabolic rate.\
2.  Calculate the mass digested during the current tick.\
3.  Compute the corresponding amounts of inorganic and methylmercury digested.\
4.  Remove digested prey mass and associated contaminants from stomach contents.\
5.  Convert a fraction of digested biomass into usable energy.\
6.  Add mercury and methylmercury to cumulative body burden pools.\
7.  When stomach contents reach zero, set foraging to true and begin lipid use.

## Design Concepts

**Basic Principles:**\
Digestion is modeled as a metabolic rate dependent process, where higher metabolic demand results in greater digestive throughput. Contaminants are transferred into the agent’s body burden proportionally to the fraction of mass digested.

**Emergence:**\
Patterns of energy gain and contaminant uptake emerge from interactions among foraging success, metabolism, digestion efficiency, and prey availability.

**Adaptation:**\
Agents respond to depleted stomach contents by transitioning into foraging mode and initiating lipid catabolism when necessary.

**Objectives:**\
Agents maximize energetic intake to support migration, physiological function, and survival while minimizing energetic deficits.

**Sensing:**\
Agents sense their own energetic state through stomach contents and energy levels.

**Stochasticity:**\
Stochasticity arises indirectly from variation in prey encounters or foraging success, although digestion itself is deterministic.

**Collectives:**\
Digestion occurs independently for each agent and does not require group level dynamics.

**Observation:**\
Outputs of interest include digested mass per tick, gained energy, contaminant uptake, and cumulative contaminant burdens.

## Initialization

| Variable | Initialized Value | Justification |
|:----------------:|:----------------------------:|:----------------------:|
| stomach-contents | 0 | Agents begin without prey unless defined by scenario. |
| stomach-contents-Hg | 0 | No initial inorganic mercury from digestion. |
| stomach-contents-MeHg | 0 | No initial methylmercury from digestion. |
| digestion-efficiency | Species specific | Determines fraction of biomass converted to energy. |
| foraging | true | Agents begin in search mode when stomach is empty. |

## Submodels

### Digestion Rate and Breakdown

Digestive throughput is driven by metabolic rate:

$$
digestion\text{-}rate = metabolism\text{-}rate
$$

Digested mass per tick:

$$
digested = stomach\text{-}contents \cdot digestion\text{-}rate
$$

Proportional mercury assimilation:

$$
digested\text{-}Hg = \left( \frac{digested}{stomach\text{-}contents} \right) \cdot stomach\text{-}contents\text{-}Hg
$$

$$
digested\text{-}MeHg = \left( \frac{digested}{stomach\text{-}contents} \right) \cdot stomach\text{-}contents\text{-}MeHg
$$

Updated stomach contents:

$$
stomach\text{-}contents = stomach\text{-}contents - digested
$$

### Energy Conversion

Energy gained from digestion:

$$
gained\text{-}energy = digested \cdot digestion\text{-}efficiency \cdot 40
$$

Updated energy pool:

$$
energy = energy + gained\text{-}energy
$$

### Contaminant Assimilation

Contaminants absorbed during digestion:

$$
mehg\text{-}foraging = digested\text{-}MeHg
$$

$$
hg\text{-}foraging = digested\text{-}Hg
$$

Accumulated body burden:

$$
mehg\text{-}total = mehg\text{-}total + digested\text{-}MeHg
$$

$$
hg\text{-}total = hg\text{-}total + digested\text{-}Hg
$$

### Transition to Foraging

When stomach contents reach zero:

-   lipid-loss is activated

This switches the prey to burn fat energy reserves instead of relying on stomach contents.

## Netlogo Implementation

```{netlogo}
;; ============================================
;; DIGESTION SUBMODEL
;; ============================================

fish-own [
  ;; digestion state
  stomach-contents
  stomach-contents-Hg
  stomach-contents-MeHg
  digestion-rate
  digestion-efficiency

  ;; contaminant tracking
  mehg-foraging
  hg-foraging
  mehg-foraging-total
  hg-foraging-total
  mehg-total
  hg-total

  ;; energy + biomass
  energy
  weight
  lipid-loss
  lipid-catabolism-efficiency
]

to digest
  ;; digestion tied to metabolic rate
  set digestion-rate metabolism-rate

  ;; nothing to digest
  if stomach-contents <= 0 [
    set foraging true
    set lipid-loss true
    stop
  ]

  ;; ============================================
  ;; DIGESTIVE BREAKDOWN
  ;; ============================================

  ;; amount of prey broken down this tick
  let digested (stomach-contents * digestion-rate)

  ;; numerical guard to avoid divide-by-zero
  if stomach-contents <= 0.000001 [ set digested 0 ]

  let digested-Hg   0
  let digested-MeHg 0

  if digested > 0 and stomach-contents > 0 [
    set digested-Hg   ((digested / stomach-contents) * stomach-contents-Hg)
    set digested-MeHg ((digested / stomach-contents) * stomach-contents-MeHg)
  ]

  ;; ============================================
  ;; UPDATE STOMACH CONTENTS
  ;; ============================================

  set stomach-contents     (max list 0 (stomach-contents - digested))
  set stomach-contents-Hg  (max list 0 (stomach-contents-Hg - digested-Hg))
  set stomach-contents-MeHg (max list 0 (stomach-contents-MeHg - digested-MeHg))

  ;; ============================================
  ;; ENERGY CONVERSION
  ;; ============================================

  let usable-energy (digested * digestion-efficiency * 40)
  set energy energy + usable-energy

  ;; ============================================
  ;; STORE LIPID IF ENERGY SURPLUS
  ;; ============================================

  if energy > 100 [
    let surplus (energy - 100)

    ;; convert surplus to lipid
    let lipid-added (surplus / 40)

    ;; apply storage efficiency
    set lipid-added (lipid-added * lipid-catabolism-efficiency)

    ;; update biomass
    set weight weight + lipid-added

    ;; subtract energy equivalent
    set energy energy - (lipid-added * 40)
  ]

  ;; ============================================
  ;; CONTAMINANT ASSIMILATION
  ;; ============================================

  set mehg-foraging          digested-MeHg
  set hg-foraging            digested-Hg
  set mehg-foraging-total    mehg-foraging-total + digested-MeHg
  set hg-foraging-total      hg-foraging-total + digested-Hg
  set mehg-total             mehg-total + digested-MeHg
  set hg-total               hg-total + digested-Hg

  ;; ============================================
  ;; SWITCH TO Lipid Loss IF EMPTY
  ;; ============================================

  if stomach-contents <= 0 [
    set lipid-loss true
  ]
end
```

