# Thermoregulation Function

## Overview

This model simulates thermoregulation behavior and physiological consequences in migratory fish agents. Each agent experiences temperature-dependent effects on movement, survival, and performance based on its local environment. Agents have defined thermal traits including an optimal temperature, a minimum viable temperature, and a maximum tolerable temperature. These constraints influence swimming speed and determine whether survival is possible in the current patch.

## Purpose and Patterns

This submodel captures ecologically grounded thermoregulatory behavior in migratory fish by simulating how temperature influences movement, survival, and physiological performance during migration and staging.

-   Agents experience thermal stress based on deviations from their optimal temperature, with stress scaling nonlinearly as conditions approach species-specific tolerance thresholds.

-   Swimming speed is reduced as environmental temperature deviates from thermal optima, reflecting empirical performance curves and diminished locomotor efficiency at suboptimal temperatures.

-   Agents calculate energy expenditure associated with thermoregulation, with increased metabolic cost arising from reduced swimming efficiency under thermal stress.

-   When thermal stress exceeds a threshold, agents evaluate neighboring patches and relocate to cooler or warmer areas to minimize physiological strain.

-   Agents track cumulative time spent beyond minimum and maximum viable temperature thresholds, and mortality occurs after sustained exposure to lethal conditions.

-   This model supports the analysis of thermal niche constraints, temperature-driven habitat selection, and the vulnerability of fish to extreme temperature events in estuarine systems.

## Entities, State Variables, and Scales

### Spatial and Temporal Scales

-   **Spatial Unit**: Patch (3 m x 3 m resolution)
-   **Temporal Unit**: 5-minute time steps (`tick`)

### Patch Variables

+----------------------------------+---------------------------------------------------------------------------+
| Variable Name                    | Definition                                                                |
+==================================+===========================================================================+
| **Temperature**\                 | The temperature of a given patch, derived from hydrodynamic model inputs. |
| $T_{patch}$                      |                                                                           |
+----------------------------------+---------------------------------------------------------------------------+

### Agent Variables

+------------------------------------------+--------------------------------------------------------------------------------+
| Variable Name                            | Definition                                                                     |
+==========================================+================================================================================+
| **Optimal Temperature** $T_{opt}$        | Optimal performance temperature                                                |
+------------------------------------------+--------------------------------------------------------------------------------+
| **Minimum Viable Temperature** $T_{min}$ | Minimum viable temperature for survival                                        |
+------------------------------------------+--------------------------------------------------------------------------------+
| **Maximum Viable Temperature** $T_{max}$ | Maximum viable temperature for survival                                        |
+------------------------------------------+--------------------------------------------------------------------------------+
| **swimming speed** $V_{agent}$           | The speed at which a prey agent is moving                                      |
+------------------------------------------+--------------------------------------------------------------------------------+
| **corrected speed** $V_{corr}$           | The corrected speed from thermal implications                                  |
+------------------------------------------+--------------------------------------------------------------------------------+
| **time below minimum** $t_{min}$         | Tracks cumulative cold exposure duration                                       |
+------------------------------------------+--------------------------------------------------------------------------------+
| **time above maximum** $t_{max}$         | Tracks cumulative heat exposure duration                                       |
+------------------------------------------+--------------------------------------------------------------------------------+
| **energy** $E_{agent}$                   | Metabolic cost associated with thermoregulation                                |
+------------------------------------------+--------------------------------------------------------------------------------+
| **swimming speed** $V_{agent}$           | The current swimming speed of the agent.                                       |
+------------------------------------------+--------------------------------------------------------------------------------+
| **acclimation rate** $\lambda$           | Rate at which agent acclimates to temperature based on size, age, and species. |
+------------------------------------------+--------------------------------------------------------------------------------+

## Process Overview and Scheduling

1.  **Thermal Stress Calculation**\
    Each agent calculates thermal stress based on the deviation between the current patch temperature and its individual thermal optimum. Stress is scaled nonlinearly to reflect increasing physiological strain near temperature limits.

2.  **Acclimation**\
    Agents gradually adjust their optimal temperature toward the current patch temperature using a fixed acclimation rate, simulating physiological plasticity over time.

3.  **Thermal Mortality Check**\
    Agents track cumulative exposure to lethal temperatures. If the patch temperature falls below the agent’s minimum threshold or exceeds its maximum threshold for more than three consecutive time steps, the agent dies.

4.  **Swimming Speed Correction**\
    Swimming speed is modified using a thermal correction factor derived from the agent’s deviation from its optimal temperature. This adjustment affects movement performance and downstream behaviors.

5.  **Thermal Avoidance**\
    If thermal stress exceeds a threshold value (e.g., \$S\_{thermal} \> 7\$), agents evaluate neighboring patches and move to the patch with the lowest thermal stress.

6.  **Energy Cost Adjustment**\
    Swimming energy cost is scaled based on the ratio of thermally corrected speed to the agent’s base swimming speed. This reflects increased metabolic effort under suboptimal thermal conditions.

## Design Concepts

**Basic Principles:** Agents are ectothermic and thermally constrained. Movement and survival depend on physiological performance at environmental temperatures.

**Emergence:** Spatial thermal gradients produce differential survival, movement, and performance outcomes across the landscape.

**Adaptation**: Agents modify their optimal temperature slowly to match local conditions, simulating physiological acclimation.

**Objectives:** Agents attempt to avoid lethal temperatures and maintain performance within their thermal niche while minimizing energy loss.

**Sensing**: Agents sense local patch temperature and compare it to their thermal limits and optimal range.

**Interaction**: Agents interact with their environment by relocating to lower-stress patches and adjusting internal states accordingly.

**Observation:** Thermal stress, adjusted swimming speed, energy cost, cumulative heat/cold exposure, and thermal mortality can be tracked per agent.

## Initialization

+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| Variable              | Initialized Value                     | Justification                                                         |
+:=====================:+:=====================================:+:=====================================================================:+
| $T_{opt}$             | Species- or life stage–specific value	 | Reflects thermal preference; varies by developmental stage or habitat |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $T_{min}$             | Species-specific threshold            | Based on empirical lower thermal limit for survival                   |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $T_{max}$             | Species-specific threshold            | Based on empirical upper thermal limit for survival                   |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $T_{patch}$           | Hydrodynamic model input              | External environmental condition updated each tick                    |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $S_{thermal}$         | 1                                     | No stress at initialization if \$T\_{patch} = T\_{opt}\$              |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $t_{min}$             | 0                                     | No prior exposure to lethal cold stress                               |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $t_{max}$             | 0                                     | No prior exposure to lethal heat stress                               |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $V_{agent}$           | Size-scaled base speed                | Initial swimming speed assuming full capacity                         |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $E_{agent}$           | 100                                   | No thermal deviation at model start                                   |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $E_{swim}$            | Size-scaled base swim cost            | Scales with body size; used in movement energy balance                |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $E_{swim}^{corr}$     | Equal to $E_{swim}$                   | No thermal penalty at initialization                                  |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+
| $\lambda$             | 0.01–0.05 (user-defined)	              | Acclimation rate controls speed of physiological adjustment           |
+-----------------------+---------------------------------------+-----------------------------------------------------------------------+

## Submodels

### Thermal Stress

Thermal stress is scaled exponentially between 1 (optimal) and 10 (at or beyond minimum or maximum viable temperatures).

$$
S_{thermal} = 1 + 9 \cdot \left(\frac{|T_{patch} - T_{opt}|}{\max(|T_{opt} - T_{min}|, |T_{max} - T_{opt}|)}\right)^k
$$

Where:

-   $S_{thermal}$ is the thermal stress score.

-   $T_{patch}$ is the current patch temperature.

-   $T_{opt}$, $T_{min}$, $T_{max}$ are the agent’s thermal preferences.

-   $k$ is an exponent controlling the steepness of the stress curve.

### Acclimation and Plasticity

$$
T_{opt}(t+1) = T_{opt}(t) + \lambda \cdot (T_{patch} - T_{opt}(t))
$$

Where:

-   $T_{opt}$ gradually shifts toward $T_{patch}$

-   $\lambda$ is the acclimation rate (e.g. 0.01-0.05)

### Temperature-Adjusted Swimming Speed (place inside migration function(s))

$$
V_{corr} = V_{agent} \cdot \left(1 - \left|\frac{T_{patch} - T_{opt}}{T_{opt}}\right|\right)
$$

Where:

-   $V_{agent}$ is the agent's swimming speed.

-   $V_{corr}$ is the thermal corrected speed.

-   $T_{patch}$ is the temperature of the current patch.

-   $T_{opt}$ is the agent’s optimal temperature.

### Thermal-Avoidance Movement (place inside migration function(s))

Agents check thermal stress in their current patch. If $S_{thermal} > 7$, they evaluate neighboring patches. The agent moves to the neighbor with the lowest $S_{thermal}$ value.

Where:

-   $S_{thermal}$ is the thermal stress score.

### Thermal Mortality Thresholds (place inside migration function(s))

$t_{min}$ and $t_{max}$ are incremented when temperature thresholds are exceeded:

$$
\text{if } T_{patch} < T_{min} \text{ for more than 3 consecutive time steps}, \quad \text{agent dies}
$$

$$
\text{if } T_{patch} > T_{max} \text{ for more than 3 consecutive time steps}, \quad \text{agent dies}
$$

Where:

-   $T_{min}$ is the minimum viable temperature.

-   $T_{max}$ is the maximum tolerable temperature.

### Energy Consumption (place inside migration function(s))

Acclimation energy cost:

$$
E_{acclimation} = \phi \cdot |T_{patch} - T_{opt}|$$

Where:

-   $E_{acclimation}$ is the energy cost for physiological acclimation.

-   $T_{patch}$ is the current patch temperature.

-   $\phi$ is a scaling constant for acclimation cost (e.g., 0.01–0.05).

-   $T_{opt}$ is the agent’s current thermal optimum.

This energy consumption corrects the energy used based on the $V_{corr}$:

$$
E_{swim}^{corr} = E_{swim} \cdot \left( \frac{V_{agent}}{V_{corr}} \right)$$

Where:

-   $E_{swim}^{corr}$ is the corrected energy cost for movement.

-   $E_{swim}$ is swimming-related energetic inefficiency from thermal deviation.

-   $V_{agent}$ is the agent's swimming speed.

-   $V_{corr}$ is the thermal corrected speed.

Total energy balance:

$$
E_{agent} = E_{agent} - (E_{swim}^{corr} + E_{acclimation})
$$

Where:

-   $E_{swim}^{corr}$ accounts for temperature-related movement inefficiency.

-   $E_{acclimation}$ accounts for metabolic costs of internal physiological adjustment.

-   $E_{agent}$ is the updated available energy of the agent.
