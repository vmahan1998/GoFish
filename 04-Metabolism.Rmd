---
editor_options: 
  markdown: 
    wrap: 72
---

# Metabolism

## Overview

Metabolism determines the energy required for fish to maintain basic
physiological function, support movement, regulate ions, digest food,
and sustain long term migration. This submodel computes metabolic rate
based on size, temperature, age scaling, and allometric relationships.
Metabolic efficiency, based on divergence from an agent's optimal
temperature, is then scaled toward multiple internal processes including
swimming, osmoregulation, and lipid catabolism.

## Purpose

To simulate energetically realistic metabolic costs for migratory fishes
in coastal and estuarine environments by accounting for size scaling,
temperature dependence, age effects, and dynamic energy partitioning
across physiological processes.

## Entities, State Variables, and Scales

### Spatial and Temporal Scales

-   **Spatial Unit**: Patch (3 m x 3 m resolution)
-   **Temporal Unit**: 5-minute time steps (`tick`)

### Global Variables

| Global Variable | Definition |
|-----------------|------------|
| **Q10** | Temperature coefficient used for metabolic scaling. |
| **base-constant** | Global constant for baseline metabolic scaling (0.1). |
| **age-sensitivity** | Scalar controlling how metabolism changes with age (0.5). |

### Patch Variables

| Variable Name | Definition |
|----------------------------------------|--------------------------------|
| **temperature** | The water temperature of the current patch used to calculate temperature dependent metabolic rate. |

### Agent Variables

| Variable Name | Definition |
|----------------------------------------|--------------------------------|
| **size** | Body mass or size index used for allometric scaling. |
| **age-num** | Age used in scaling metabolic rate. |
| **optimal-temperature** | Preferred temperature at which baseline metabolism is defined. |
| **max-survival-temp** | Maximum temperature at which the agent can survive and function. |
| **Met-base** | Baseline metabolic constant calculated during initialization. |
| **metabolism-rate** | Metabolic rate for the current tick. |
| **total-metabolism** | Accumulated metabolism over time. |
| **swim-efficiency** | Efficiency applied to movement when metabolic rate is lower or higher than baseline. |
| **osmoregulation-efficiency** | Efficiency applied to osmoregultion when metabolic rate is lower or higher than baseline. |
| **lipid-catabolism-efficiency** | Efficiency applied to lipid catabolism when metabolic rate is lower or higher than baseline. |
| **swim-base** | Baseline allocation of metabolism toward movement. |
| **E-base** | Base metabolic maintenance cost. |
| **E-creation** | Energy cost for creating new chloride cells. |
| **E-osmo** | Total energy spent on osmoregulation. |
| **motion-ratio** | Fraction of metabolism allocated to swimming. |
| **osmo-ratio** | Fraction of metabolism allocated to osmoregulation. |
| **M-max** | Maximum size for scaling across the population. |
| **max-age** | Maximum age for scaling across the population. |

## Process Overview and Scheduling

1.  Retrieve patch temperature and verify safe environmental inputs.
2.  Compute allometric, temperature, and age scalars.
3.  Calculate metabolic rate for the current tick.
4.  Update metabolic accumulation.
5.  Compute a reference baseline metabolic rate.
6.  Apply efficiency multipliers to swimming, digestion, osmoregulation,
    and lipid catabolism.

## Design Concepts

**Basic Principles:**\
Metabolic rate combines allometric scaling, temperature responses, and
age scaling consistent with metabolic ecology theory. The model uses a
Q10 temperature function, Kleiber type allometry, and age dependent
reduction in metabolic intensity.

**Emergence:**\
Energetic constraints emerge from interactions among size, temperature,
and age. These constraints then shape movement, digestion, and
osmoregulation.

**Adaptation:**\
Agents adapt by adjusting internal efficiencies that influence
downstream behavioral and physiological submodels.

**Objectives:**\
Agents maintain adequate energy for survival and migration and balance
energetic cost across processes.

**Sensing:**\
Agents sense the temperature of the patch they occupy.

**Stochasticity:**\
The function itself is deterministic but stochastic variation in
individual size and age creates emergent metabolic variation.

**Collectives:**\
Scaling uses the maximum size and age of the entire population to
normalize differences among individuals.

**Observation:**\
Outputs include metabolism-rate, total-metabolism, and efficiency
multipliers.

## Initialization

| Variable | Initialized Value | Justification |
|:----------------:|:----------------------------:|:----------------------:|
| Met-base | Computed using size, age, and temperature factors | Establishes a physiologically realistic baseline. |
| swim-base | Met-base times movement ratio | Allocates baseline metabolism for locomotion. |
| E-base | Met-base times 0.02 | Maintenance cost of cellular metabolic activity. |
| E-creation | Met-base times 0.05 | Cost of forming new chloride cells. |
| motion-ratio | 0.7 normalized | Movement is energetically dominant. |
| osmo-ratio | 0.3 normalized | Osmoregulation is energetically significant. |
| E-osmo | 0 | No osmoregulation cost at initialization. |
| metabolism-rate | Met-base | Baseline metabolism in the absence of environmental variation. |
| total-metabolism | 0 | Starts accumulation at zero. |

## Submodels

### Initialize Metabolism

Baseline metabolic constant is computed using:

\$\$Met-base = base-constant *(size / M-max) \^ 0.75* [1 +
age-sensitivity \* (1 - age / max-age)] \* (optimal-temperature /
max-survival-temp)\$\$

Where:

-   base-constant is 0.1
-   age-sensitivity is 0.5

### Energy Partitions

Baseline energy partitions are computed from the initialized metabolic base:

$$
\text{swim-base} = \text{Met-base} \cdot \text{motion-ratio}
$$

$$
E_{\text{base}} = \text{Met-base} \cdot 0.02
$$

$$
E_{\text{creation}} = \text{Met-base} \cdot 0.05
$$


### Metabolic Rate Calculation

At each tick, metabolism is recalculated using allometric, temperature, and age scaling:

$$
\text{size-factor} = \left(\frac{\text{weight}}{\text{M-max}}\right)^{0.75}
$$

$$
\text{temp-factor} = Q_{10}^{\left(\frac{T_{\text{env}} - T_{\text{opt}}}{10}\right)}
$$

$$
\text{age-factor} = 1 + \left(1 - \frac{\text{age}}{\text{max-age}}\right)\cdot 0.5
$$

Total metabolic rate:

$$
M_{\text{total}} = \text{Met-base} \cdot 
\text{size-factor} \cdot 
\text{temp-factor} \cdot 
\text{age-factor}
$$

Metabolic accumulation:

$$
\text{total-metabolism} = \text{total-metabolism} + M_{\text{total}}
$$


### Efficiency Multipliers

A baseline metabolic reference is defined using:

- baseline size-factor = 1  
- baseline age-factor = 1.5  
- baseline temp-factor = 1  

Thus:

$$
M_{\text{baseline}} =
\text{Met-base} \cdot 1 \cdot 1 \cdot 1.5
$$

Efficiency is computed as:

$$
\text{efficiency} = 
\frac{M_{\text{total}}}{M_{\text{baseline}}}
$$

This value is applied to:

- **swim-efficiency**  
- **osmoregulation-efficiency**  
- **lipid-catabolism-efficiency**

Efficiency dynamically scales the cost of movement, ion regulation, and lipid catabolism.

## Netlogo Implementation

```{netlogo}

;; ============================
;;   METABOLISM SUBMODEL
;; ============================

globals [
  ;; global physiological constants
  Q10
]

patches-own [
  temperature
]

fish-own [
  ;; core state variables
  weight
  age-num
  optimal-temperature
  max-survival-temp

  ;; metabolic scalars
  Met-base
  metabolism-rate
  total-metabolism

  ;; efficiency multipliers
  swim-efficiency
  osmoregulation-efficiency
  lipid-catabolism-efficiency

  ;; energy partitioning
  swim-base
  E-base
  E-creation
  E-osmo
  motion-ratio
  osmo-ratio

  ;; population normalization
  M-max
  max-age
]

;; ======================================
;;       INITIALIZE METABOLISM
;; ======================================

to initialize-metabolism
  let beta 0.75
  let age-sensitivity 0.5
  let base-constant 0.1
  
  ;; normalize population scaling
  set M-max max [weight] of fish
  set max-age max [age-num] of fish
  if M-max <= 0 [ set M-max 1 ]
  if max-age <= 0 [ set max-age 1 ]

  ;; scaling factors
  let size-factor (weight / M-max) ^ beta
  let age-factor 1 + age-sensitivity * (1 - (age-num / max-age))
  let temp-factor (optimal-temperature / max-survival-temp)

  ;; baseline metabolic constant
  set Met-base base-constant * size-factor * age-factor * temp-factor

  ;; energy partitions
  let motion-ratio-local 0.7
  let osmo-ratio-local   0.3
  let total-ratio (motion-ratio-local + osmo-ratio-local)

  set motion-ratio (motion-ratio-local / total-ratio)
  set osmo-ratio   (osmo-ratio-local / total-ratio)

  set swim-base (Met-base * motion-ratio)
  set E-osmo 0

  ;; fixed fractions
  set E-base     (Met-base * 0.02)
  set E-creation (Met-base * 0.05)

  ;; initial metabolic state
  set metabolism-rate Met-base
  set total-metabolism 0
end


;; ======================================
;;        CALCULATE METABOLISM EACH TICK
;; ======================================

to calculate-metabolism
  let beta 0.75

  ;; repopulate scaling values
  set M-max max [weight] of fish
  set max-age max [age-num] of fish
  if M-max <= 0 [ set M-max 1 ]
  if max-age <= 0 [ set max-age 1 ]

  ;; get patch temperature safely
  let T-env [temperature] of patch-here
  if not is-number? T-env [ set T-env optimal-temperature ]

  ;; scaling factors
  let size-factor (weight / M-max) ^ beta
  let temp-factor Q10 ^ ((T-env - optimal-temperature) / 10)
  let age-factor 1 + (1 - (age-num / max-age)) * 0.5

  ;; metabolic rate (per tick)
  let M-total Met-base * size-factor * temp-factor * age-factor
  set metabolism-rate M-total
  set total-metabolism total-metabolism + M-total

  ;; baseline reference metabolism
  let baseline-size-factor 1
  let baseline-age-factor 1.5
  let baseline-temp-factor 1

  let baseline-metabolism Met-base *
      baseline-size-factor *
      baseline-temp-factor *
      baseline-age-factor

  ;; efficiency multipliers
  let efficiency M-total / baseline-metabolism

  set swim-efficiency              efficiency
  set osmoregulation-efficiency    efficiency
  set lipid-catabolism-efficiency  efficiency
end

```

