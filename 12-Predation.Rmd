# Predation and Fleeing Behavior

## Overview

This module simulates predator–prey interactions between migratory fish species, specifically predators (i.e., striped bass) and prey (i.e., alewife), during key migratory and staging periods. Predators detect, pursue, and consume prey based on visibility conditions and prey size constraints. Prey detect approaching predators through visual and social cues and respond with directional fleeing behaviors, which vary based on their size, age, energy level, and water clarity. These behaviors reflect biologically observed trade-offs between escape speed, reaction time, and group-based vigilance. The model also tracks predator energy gain and prey energy depletion and recovery, allowing for analysis of individual fitness and risk exposure under different environmental and behavioral conditions.

## Purpose and Patterns

This submodel captures ecologically grounded predator–prey dynamics by simulating behaviorally realistic rules of pursuit and evasion observed in estuarine fishes.

-   Prey initiate fleeing based on predator proximity, visual detection, and turbidity-adjusted reaction time, reflecting sensory limitations in murky estuarine water.

-   Predators only pursue prey that are within their gape limit and provide a favorable energy return, consistent with optimal foraging theory and size-selective predation.

-   Fleeing speed is scaled by energy and body size, capturing the biologically observed trade-off between fatigue and escape performance.

-   Directional fleeing (left, right, up, or down) is based on the predator's relative position, aligning with empirical studies on spatial escape responses.

-   Patch-level alarm cues propagate fleeing behavior across prey groups, mimicking the benefits of schooling and collective vigilance in fish.

-   Energetic constraints influence both predator foraging frequency and prey escape success, contributing to variability in encounter outcomes.

-   Spatial tracking of predation events allows identification of high-risk zones, offering insight into how environmental conditions shape survival landscapes.

## Entities, State Variables, and Scales

### Spatial and Temporal Scales

-   **Spatial Unit**: Patch (3 m x 3 m resolution)

<!-- -->

-   **Temporal Unit**: 5-minute time steps (`tick`)

### Patch Variables

| Variable Name | Definition |
|------------------------------------|------------------------------------|
| **Suspended-particulate-matter** $SPM_{t}$ | Level of suspended material in patch (exponential difficulty increase between min and max observed in system) worse vision at max, best vision at min |
| **Prey-Eaten-in-Patch** | Counts how much prey are consumed in a patch |
| **Prey-in-Patch** $prey-in-patch_{t}$ | The amount of prey currently in the patch |
| **prey-alarmed?** | Boolean variable set to true if any prey in the patch initiates fleeing behavior, triggering collective escape. |

### Prey: Agent Variables

| Variable Name | Definition |
|------------------------------------|------------------------------------|
| vision | Radius (in patches) within which the prey can detect predators. Decreases with high SPM. |
| fleeing? | Boolean indicator of whether the prey is actively escaping from a predator. |
| energy | Energy levels of an agent |
| swimming speed | The speed at which a prey agent is moving |
| max-speed | Maximum normal swim speed (not in a flee state). |
| max-flee | Maximum achievable fleeing speed, calculated as a function of max-speed, swimming-speed, size, and max-rate-of-speed-change. |
| reaction-time | Time delay in response to predator presence. Increases with smaller size, higher SPM, larger/faster predators, and lower flee-ability. |
| size | Body length (size) of the prey; influences visibility and escape ability. |
| age | Agent's age class; mid-range age groups tend to have better escape success (a normal distribution across age classes). |
| flee-ability | Learning metric based on age; moderate-aged fish have best reflexes and performance. |

### Predator: Agent Variables

| Variable Name | Definition |
|------------------------------------|------------------------------------|
| vision | Radius (in patches) within which predator can visually detect prey. Decreases with high SPM or low prey size. |
| swimming-speed | The speed at which a predator agent is moving |
| max-speed | Maximum normal swim speed (not in a burst state). |
| bursting? | Boolean indicating whether the predator is currently in a high-speed chase or attack behavior. |
| prey-in-vision | Agentset of prey within vision range |
| daytime-prey-eaten | Count of prey eaten that day |
| time-since-full | Time since last feeding (when will predator be hungry again?) |
| reaction-time | Delay between prey detection and initiation of chase. Influenced by predator size/age, prey density, prey speed, water clarity (SPM), and predation ability. |
| limit-daily-prey-allowance | Max prey allowed per day (predator becomes full) |
| gape-limit | Maximum size of prey the predator can successfully capture and ingest. |
| handling-effort | Time and energy cost required to subdue and consume a prey item. Depends on distance, prey size, and prey density. Used in patch and prey selection decisions. |
| size | Body length (size) of the prey; influences visibility and escape ability. |
| age | Age class of the predator agent. Predation success follows a normal distribution across age classes. |
| predation-ability | Agent's age class; mid-range age groups tend to have better predation success (a normal distribution across age classes). |
| prey-species-eaten | Species identifiers of consumed prey; enables diet tracking and multispecies modeling. |
| total-prey-eaten | Cumulative prey consumed across all days or scenarios. |
| digestion-time | Time it takes to digest prey |

## Process Overview and Scheduling

### Prey Behavior (per agent)

1.  **Fleeing Trigger**\
    Each prey evaluates whether a predator is in its visual cone or whether `prey-alarmed? = true` in the patch. If so, the prey calculates reaction time based on its own size, age, flee-ability, local SPM, and the predator’s size and speed.

2.  **Directional Escape**\
    If the reaction time threshold is met, the prey executes a directional fleeing behavior (`scare-left`, `scare-right`, `scare-down`, or `scare-up`), and sets the patch to `prey-alarmed? = true`.

3.  **Schooling Response**\
    All other prey in the same patch automatically begin fleeing when `prey-alarmed? = true`, simulating social alarm propagation.

4.  **Speed and Energy Update**\
    If the agent is fleeing, its speed increases toward `max-flee`, and energy is reduced based on movement cost. If not fleeing, the agent moves normally and may recover energy depending on its resting status.

### Predator Behavior (per agent)

1.  **Visual Detection**\
    The predator identifies prey within its in-cone vision, adjusted based on local SPM concentration, prey size, and predator size.

2.  **Prey Filtering**\
    Prey that exceed the predator’s gape limit or whose handling effort exceeds the predator’s available energy are excluded.

3.  **Prey Selection**\
    Among remaining prey, the predator evaluates candidates using an optimal foraging approach that considers size, handling effort, and net energy gain. One prey is selected.

4.  **Pursuit Decision**\
    If a prey is selected, the predator enters a bursting state, increasing its speed toward max-speed. Reaction time is computed based on predator age, size, SPM, and prey proximity.

5.  **Scare Prey**\
    The predator triggers fleeing in visible prey by calling the `scare-prey` procedure. If any prey flees, the patch is flagged as `prey-alarmed? = true`.

6.  **Consume Prey**\
    If within striking range, the predator consumes the prey and updates variables: `daytime-prey-eaten`, `prey-species-eaten`, `total-prey-eaten`, and `Prey-Eaten-in-Patch`.

7.  **Digestion**\
    If no prey are eaten, `time-since-eaten` increases. If the predator has reached its daily feeding limit, it enters a digestive phase. Digestion ends when both `time-since-eaten` and `time-since-full` exceed the digestion time

## Design Concepts

**Basic Principles:** Simulates predator and prey interactions in a spatial estuarine system. Behaviors such as chasing, fleeing, and feeding are determined by individual traits, patch conditions, and environmental clarity due to suspended particulate matter.

**Emergence:** Predation hotspots develop in areas with higher prey density and better visibility. Prey movement and group alarm responses create shifting patterns of refuge and risk across the landscape.

**Adaptation**: Prey modify their direction and intensity of escape based on the predator’s location and their own size, age, and escape ability. Predators filter out prey that are too large to consume and shift to resting behavior after reaching their feeding limit.

**Objectives:** Predators aim to select prey that provide the highest net energy gain while minimizing pursuit and handling costs. Prey aim to avoid detection or flee successfully using both individual detection and social alarm cues.

**Learning:** Learning is represented through Mid-aged agents generally perform better than very young or very old individuals.

**Prediction:**

**Sensing**: Agents rely on in-radius and in-cone vision to detect others. Detection range is influenced by water clarity, body size, and prey movement. Predators exclude prey that are too large to handle even if they fall within the visible field.

**Interaction**: Predators and prey interact through visual detection, spatial proximity, and energy transfer through feeding. Social interactions occur through alarm cue propagation at the patch level and school level.

**Stochasticity**: Prey selection, fleeing direction, and reaction timing include probabilistic variation. Randomness is used to reflect natural variability in movement and perception.

**Collectives:** When one prey detects a predator and flees, all prey in the same patch respond. This collective behavior improves predator detection and increases the likelihood of survival through schooling.

**Observation:** Key outputs include prey consumption, alarm responses, spatial predation distribution, and energy use of individual agents.

## Initialization

| Variable | Initialized Value | Justification |
|:----------------------:|:----------------------:|:----------------------:|
| energy | 100 | Prey begin fully energized to allow immediate fleeing or normal movement |
| fleeing? | false | Prey are not actively escaping at the start |
| prey-alarmed? | false | Alarm cue inactive at start of simulation |
| daytime-prey-eaten | 0 | daily counter of prey eaten starts at zero |
| time-since-full | 0 | predator begins simulation hungry |
| gape-limit | function of size | Large predators have wider gape limits |
| handling-effort | calculated per encounter | Depends on prey traits and local patch conditions |
| reaction-time | size-, age-, and SPM-based | Prey and predator values dynamically computed each tick |
| flee-ability | based on age | Represents individual escape competence across age classes |
| predation-ability | based on age | Mid-age predators have fastest and most accurate prey responses |
| max-speed | 1.5-3.0x size |  |

## Submodels

### Prey Detection Probability

Visual detection of prey by predators is scaled by local water clarity, prey size, and prey movement. The effective detection radius decreases as SPM increases and increases as prey size increases.

$$
P_{detect} = \left( \frac{S_{prey}}{S_{max}} \right) \cdot e^{-SPM_t / \tau}
$$

Where:

-   $P_{detect}$ is the probability of detecting a prey agent.

-   $S_{prey}$ is the size of the prey agent.

-   $S_{max}$ is the maximum size of any prey in the system.

-   $SPM_t$ is the suspended particulate matter concentration in the current patch.

-   $\tau$ is a turbidity scaling constant.

Biological Justification: Larger prey are more visible, but high turbidity (SPM) reduces contrast and visual range. The exponential function reflects rapid degradation of visibility with increased turbidity.

### Reaction Time

Reaction time determines how quickly an agent initiates a behavior in response to a threat (for prey) or opportunity (for predators). It is influenced by SPM, size, age, and ability.

$$
RT_{agent} = \left( \frac{1}{F_{ability}} \cdot \frac{S_{opp}}{S_{agent}} \right) \cdot (1 + \alpha \cdot SPM_t)
$$

Where:

-   $RT_{agent}$ is the reaction time of the prey or predator.

-   $F_{ability}$ is flee-ability (for prey) or predation-ability (for predators).

-   $S_{opp}$ is the size of the opposing agent (predator or prey).

-   $S_{agent}$ is the size of the focal agent.

-   $SPM_t$ is the suspended particulate matter in the patch.

-   $\alpha$ is the turbidity penalty factor.

Biological Justification: Smaller or younger fish tend to react slower. High turbidity delays response time. Age-related ability improves reaction time in middle-aged agents.

### Alarm Response Propagation

$$
P_{alarm} = 1 - e^{\frac{-n_{flex}}{k}}
$$

Where:

-   $P_{alarm}$ is the probability that non-detecting prey will flee.

-   $n_{flee}$ is the number of fleeing fish in the patch.

-   $\kappa$ is a sensitivity constant governing social responsiveness.

**Biological Justification:** Prey benefit from collective vigilance. The more individuals that flee in a patch, the more likely others will follow.

### Fleeing Speed

The maximum speed a prey agent can reach when fleeing is scaled by body size, energy, and physical acceleration limits.

$$
V_{flee} = V_{max} \cdot \left( \frac{E_{agent}}{100} \right) + \delta \cdot S_{agent}
$$

Where:

-   $V_{flee}$ is the maximum fleeing speed.

-   $V_{max}$ is the prey’s maximum speed.

-   $E_{agent}$ is the energy level of the prey agent.

-   $S_{agent}$ is the size of the prey.

-   $\delta$ is a scaling factor for size-based speed increase.

Biological Justification: Larger prey generally swim faster, but energy limits how much of that speed can be used. Exhausted fish flee more slowly.

### Handling Effort

Predators calculate the cost of pursuing and consuming prey using the prey’s size and density, and the distance to the target.

$$
H_{effort} = \gamma \cdot S_{prey} \cdot D_{patch} \cdot \left(1 + \frac{1}{\rho_{patch}} \right)
$$

Where:

-   $H_{effort}$ is the handling effort for the predator.

-   $S_{prey}$ is the size of the prey.

-   $D_{patch}$ is the distance between predator and prey.

-   $\rho_{patch}$ is the prey density in the patch.

-   $\gamma$ is a handling cost coefficient.

Biological Justification: Prey that are farther away or more dispersed are harder to catch. Denser prey clusters reduce handling time by enabling rapid repeat captures.

### Gape Filtering

Predators apply a binary filter before pursuit, excluding prey that exceed their maximum ingestible size.

$$
P_{pursue} =\begin{cases}1 & \text{if } S_{prey} \leq G_{pred} \\0 & \text{otherwise}\end{cases}
$$

Where:

-   $P_{pursue}$ is the pursuit decision (1 = pursue, 0 = ignore).

-   $S_{prey}$ is the size of the prey.

-   $G_{pred}$ is the predator’s gape limit.

Biological Justification: Predators cannot capture or ingest prey that are too large, so these individuals are ignored even if they are detected.

### Energy Gain by Predators

$$
E_{agent} = E_{agent} - E_{burst}
$$

Where:

-   $E_{agent}$ is the current energy of the predator.

-   $E_{burst}$ is the energy cost per unit of bursting behavior.

**Biological Justification:** Bursting reduces available energy. Energy cost is a limiting factor for predation.

### Energy Depletion by Prey

$$
E_{agent} = E_{agent} - E_{flee}
$$

Where:

-   $E_{agent}$ is the current energy of the prey.

-   $E_{flee}$ is the energy cost per unit of fleeing behavior.

**Biological Justification:** Fleeing reduces available energy and increases recovery time. Energy loss is a limiting factor for repeated escape attempts.

(no need to account for swimming energy in addition if you are using the migration functions)
