# Filter Feeding

## Overview

Filter feeding is a foraging behavior in which fish consume suspended particulate matter as they migrate through estuarine and coastal systems. In this submodel, agents evaluate neighboring patches based on suspended particulate matter concentration and selectively filter feed where energetic return is highest. Filtration capacity increases with body size, metabolic rate, and digestion efficiency, and is reduced under competition from other filter feeding fish. Contaminant loads in the water column directly influence mercury and methylmercury assimilation during feeding, including biomagnification effects.

## Purpose and Patterns

The purpose of this submodel is to simulate ecologically realistic filter feeding behavior in migratory fish using suspended particulate matter as a food resource. This behavior links hydrodynamic particle fields to energy gain, contaminant exposure, and movement decisions. Filter feeding only occurs when spatial conditions and energetic returns are favorable, and incorporates competition, biomagnification, and digestion constraints.

This submodel represents the following ecological patterns:

-   **Filtration capacity increases with body size, metabolism, and digestive efficiency**\
    Larger individuals with higher metabolism filter more water and assimilate more prey mass.

-   **Gaussian SPM preference centered on optimal SPM**\
    Feeding intensity is highest near an optimal SPM range and decreases away from that peak.

-   **Crowding penalty from con-specifics**\
    Filtration benefit decreases when multiple individuals feed in the same patch.

-   **Movement toward highest benefit**\
    Fish move toward the patch with the highest filtration benefit based on SPM and competitive pressure.

-   **Contaminant assimilation tied directly to filtration**\
    Mercury and methylmercury are assimilated proportionally to SPM concentration and biomagnification factors derived from empirical trophic magnification relationships.

## Entities, State Variables, and Scales

### Spatial and Temporal Scales

**Spatial Unit:** Patch (3 m x 3 m resolution)\
**Temporal Unit:** 5 minute time steps (tick)

### **Global Variables**

| Global Variable | Definition |
|------------------------------------|------------------------------------|
| **spm-sd** | Standard deviation for Gaussian SPM preference curve (controls width of feeding preference) |
| **max-filter-distance** | Maximum distance within which patches can be evaluated (optional, model dependent) |
| **BMF-MeHg** | Biomagnification factor for methylmercury (≈ 1.74; after Lavoie et al. 2013) |
| **BMF-Hg** | Biomagnification factor for inorganic Hg (≈ 1.38; after Lavoie et al. 2013) |
| **previous-x** | X-coordinate of agent’s previous location (used to compute travel distance and energy cost) |
| **previous-y** | Y-coordinate of agent’s previous location (used with previous-x) |

### **Patch Variables**

| Variable Name | Definition |
|------------------------------------|------------------------------------|
| **SPM** | Suspended particulate matter concentration in the water column |
| **mercury** | Inorganic mercury concentration at the patch |
| **methylmercury** | Methylmercury concentration at the patch |
| **patch-terrain** | Identifies water or land patches |

### **Agent Variables**

| Variable Name | Definition |
|------------------------------------|------------------------------------|
| **size** | Body size used to scale filtration capacity |
| **weight** | Biomass used in base filtration scaling (from metabolism submodel) |
| **metabolism-rate** | Metabolic rate that modulates filtration intensity |
| **digestion-efficiency** | Fraction of filtered biomass digested |
| **optimal-SPM** | SPM concentration where filtration is most efficient |
| **filter-feed?** | Boolean indicating whether the agent engages in filter feeding |
| **energy** | Current energy reserves |
| **E-swim** | Energy cost of swimming per meter |
| **swim-efficiency** | Efficiency of movement based on metabolic state |
| **speed** | Swimming speed |
| **stomach-contents** | Biomass currently held in the stomach |
| **stomach-capacity** | Maximum biomass that can be held |
| **stomach-contents-Hg** | Inorganic mercury within stomach contents |
| **stomach-contents-MeHg** | Methylmercury within stomach contents |
| **hg-total** | Total cumulative inorganic mercury body burden |
| **mehg-total** | Total cumulative methylmercury body burden |
| **hg-exposure-total** | Cumulative Hg exposure from all pathways |
| **mehg-exposure-total** | Cumulative MeHg exposure from all pathways |
| **hg-exposure-total-normalized** | Normalized inorganic mercury exposure |
| **mehg-exposure-total-normalized** | Normalized methylmercury exposure |
| **previous-x** *(if not global)* | Previous x-location for travel-distance calculation |
| **previous-y** *(if not global)* | Previous y-location |

## Process Overview and Scheduling

1.  Compute filtration capacity based on size, metabolism, and digestion efficiency.\
2.  Evaluate neighboring patches using a Gaussian suitability curve around optimal SPM.\
3.  Apply a competition penalty based on the number of con-specifics feeding on each patch.\
4.  Select the patch with the highest filtration benefit.\
5.  Move toward the chosen patch with travel distance reduced by swimming efficiency.\
6.  Apply swimming energy cost.\
7.  Filter feed by assimilating SPM scaled biomass from the chosen patch.\
8.  Assimilate mercury and methylmercury using biomagnification factors from Lavoie et al (2013).\
9.  Add assimilated biomass and contaminants to stomach contents.

## Design Concepts

**Basic Principles**\
Filter feeding reflects how pelagic and estuarine fish forage on suspended particles while migrating. Filtration scales with size, metabolism, and digestive efficiency. SPM determines food availability and contaminant exposure.

**Emergence**\
Feeding hotspots emerge where hydrodynamic SPM fields align with optimal SPM and competition is minimal. Contaminant loads emerge from local mercury and methylmercury concentrations and biomagnification.

**Adaptation**\
Agents adjust their direction and feeding behavior based on SPM quality, filtration capacity, and local competition.

**Sensing**\
Agents sense SPM, mercury, methylmercury, competition from conspecifics, stomach fullness, and their own metabolic and digestive state.

**Stochasticity**\
Variation in SPM quality, contaminant concentrations, and local competition create variability in feeding and assimilation outcomes.

**Interaction**\
Competition reduces filtration benefit when more fish feed on the same patch. Mercury and methylmercury assimilation depends on local contaminant levels and feeding intensity.

**Observation**\
The model tracks biomass intake, mercury and methylmercury assimilation, stomach contents, and contaminant load added per patch.

## Initialization

| Variable | Initialized Value | Justification |
|------------------------|------------------------|------------------------|
| stomach-contents | 0 | No biomass in the stomach at model start |
| stomach-contents-Hg | 0 | No initial inorganic mercury from feeding |
| stomach-contents-MeHg | 0 | No initial methylmercury |
| digestion-efficiency | Species specific | Determines fraction of filtered biomass assimilated |
| optimal-SPM | Species specific | Represents preferred SPM concentration |

## Submodels

### Filtration Capacity

Filtration scales with size, metabolism, and digestion efficiency:

$$
Filtration_{base} = \left(\frac{size}{100}\right) \cdot metabolism\_{rate} \cdot digestion\_{efficiency}
$$

### SPM Interest (Gaussian Suitability)

Suitability peaks at the optimal SPM and declines with distance:

$$
Interest = e^{-\frac{(SPM - optimalSPM)^2}{2 \cdot \sigma^2}}
$$

Where $\sigma$ is the SPM standard deviation tolerance (here 25).

### Benefit Calculation

Benefit for each neighboring patch:

$$
Benefit = SPM \cdot Interest \cdot Filtration_{base}
$$

If con-specifics are present:

$$
Benefit = \frac{Benefit}{N_{conspecifics}}
$$

### Movement

Travel distance is reduced by swimming efficiency:

$$
Distance = min(DistanceToPatch,\ speed \cdot swim\_{efficiency})
$$

Energy cost of swimming:

$$
Energy = Energy - (E\_{swim} \cdot Distance)
$$

### Feeding and Stomach Loading

Assimilated biomass:

$$
Intake = min(PreyAssimilated,\ StomachCapacity - StomachContents)
$$

### Contaminant Assimilation and Biomagnification

Biomagnification factors follow @lavoie_biomagnification_2013:

$$
BMF_{MeHg} = 10^{(0.24 \cdot \Delta TP)}
$$

$$
BMF_{Hg} = 10^{(0.14 \cdot \Delta TP)}
$$

With $\Delta TP = 1$:

$$
BMF_{MeHg} = 10^{0.24} \approx 1.74
$$

$$
BMF_{Hg} = 10^{0.14} \approx 1.38
$$

Assimilation equations:

$$
MeHg_{assim} = SPM \cdot MeHg_{patch} \cdot BMF_{MeHg} \cdot PreyAssimilated
$$

$$
Hg_{assim} = SPM \cdot Hg_{patch} \cdot BMF_{Hg} \cdot PreyAssimilated
$$

Stomach contaminant update:

$$
StomachMeHg = StomachMeHg + MeHg_{assim}
$$

$$
StomachHg = StomachHg + Hg_{assim}
$$

```{netlogo}

globals [
  ;; Filter feeding parameters
  spm-sd                    ;; standard deviation for Gaussian SPM preference curve (≈25)
  max-filter-distance       ;; how far fish can evaluate patches (optional)

  ;; Biomagnification constants from Lavoie et al. 2013
  BMF-MeHg                  ;; ≈ 1.74 (MeHg biomagnification factor)
  BMF-Hg                    ;; ≈ 1.38 (Hg biomagnification factor)
]

patches-own [
  ;; physical environment
  SPM                         ;; suspended particulate matter
  patch-terrain               ;; "water" or "land"

  ;; contaminant concentrations
  mercury                     ;; inorganic Hg
  methylmercury               ;; MeHg
]

fish-own [

  ;; ---------------------------
  ;; Filter feeding physiology
  ;; ---------------------------
  size                          ;; body size scaling filtration
  metabolism-rate               ;; modulates filtration intensity
  digestion-efficiency          ;; fraction of filtered biomass digested
  optimal-SPM                   ;; preferred SPM concentration
  filter-feed?                  ;; Boolean: whether agent filter feeds

  ;; ---------------------------
  ;; Movement & energy
  ;; ---------------------------
  speed                         ;; movement rate
  swim-efficiency               ;; metabolism-adjusted efficiency
  E-swim                        ;; energy cost per unit distance
  energy                        ;; energetic budget

  ;; ---------------------------
  ;; Stomach contents
  ;; ---------------------------
  stomach-contents
  stomach-capacity
  stomach-contents-Hg           ;; inorganic Hg from filter feeding
  stomach-contents-MeHg         ;; MeHg from filter feeding

  ;; ---------------------------
  ;; Contamination physiology
  ;; (needed for risk integration)
  ;; ---------------------------
  hg-total                      ;; cumulative Hg body burden
  mehg-total                    ;; cumulative MeHg body burden
  hg-exposure-total
  mehg-exposure-total
  hg-exposure-total-normalized
  mehg-exposure-total-normalized
]

to filter-feed
if filter-feed? [
  let spm-sd 25
  ;; Base filtration capacity scales with body size *and* metabolism
  let base-filtration ((weight / 100) * metabolism-rate)
  set base-filtration (base-filtration * digestion-efficiency)
  let neighbors-list sort (neighbors with [patch-terrain = "water"])
  let best-patch nobody
  let best-score -999

  foreach neighbors-list [p ->
    let spm-patch [SPM] of p
    let interest exp (- ((spm-patch - optimal-SPM) ^ 2) / (2 * (spm-sd ^ 2)))
    let benefit (spm-patch * interest * base-filtration)
    let comp count alewives-on p
    if comp > 0 [ set benefit benefit / comp ]
    if benefit > best-score [
      set best-score benefit
      set best-patch p
    ]
  ]

  if best-patch != nobody and [patch-terrain] of best-patch = "water" [
    face best-patch
    face best-patch
    move-to best-patch
      
    ;; calculate ditance between best patch and previous patch 
    let travel-distance distancexy previous-x previous-y
      
    ;; --- Swimming energy cost (scaled by efficiency) ---
    set energy max list 0 (energy - (E-swim * travel-distance))

    ;; --- Feeding and digestion (temperature-dependent) ---
    let patch-spm [SPM] of best-patch
    let prey-assimilated patch-spm * base-filtration * 300
      
    ;; --- Contaminant uptake (SPM × Hg and MeHg) ---
    let spm-hg [mercury] of best-patch
    let spm-mehg [methylmercury] of best-patch
      
    ;; --- Biomagnification ---
    let biomag-factor (random-float 30) + 60  ;; random 60–90
    let hg-assimilated (patch-spm * spm-mehg * biomag-factor * prey-assimilated)
    let mehg-assimilated (patch-spm * spm-hg * (biomag-factor / 10) * prey-assimilated)
      
    ;; Remaining capacity
    let space-available (stomach-capacity - stomach-contents)

    ;; You can only eat as much as fits
    let intake (min (list prey-assimilated space-available))

    ;; Add biomass to stomach
    set stomach-contents (stomach-contents + intake)
    set stomach-contents-Hg (stomach-contents-Hg + hg-assimilated);; mercury stomach amount
    set stomach-contents-MeHg (stomach-contents-MeHg + mehg-assimilated);; methylmercury stomach amount

  ]
end
```
